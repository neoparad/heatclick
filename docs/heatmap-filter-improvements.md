# ヒートマップページのフィルター改善

**作成日**: 2025年1月26日  
**目的**: ヒートマップページのフィルター機能を改善し、サイト選択と期間選択を統合

---

## ✅ 実施した改善

### 1. フィルターカードの統合

**問題点**:
- サイト選択とページ選択が別々のカードに分かれていた
- 期間選択機能が実装されていなかった
- フィルター機能が使いにくかった

**改善内容**:
- ✅ サイト選択、期間選択、ページ選択を1つのフィルターカードに統合
- ✅ 3列のグリッドレイアウトで表示（レスポンシブ対応）
- ✅ カードタイトルを「フィルター」に変更
- ✅ 説明文を追加（「サイト、期間、ページを選択してヒートマップを表示」）

**技術的な変更**:
- `app/heatmap/page.tsx`:
  - フィルターカードを新規作成
  - 3列のグリッドレイアウトを実装
  - 旧バージョンのカードを非表示化（`false &&`で条件分岐）

---

### 2. 期間選択機能の追加

**問題点**:
- ヒートマップデータを期間でフィルタリングできなかった
- 特定の期間のデータを分析することができなかった

**改善内容**:
- ✅ 期間選択ドロップダウンを追加（過去7日間、30日間、90日間、全期間）
- ✅ 期間選択に基づいてAPIリクエストに`start_date`と`end_date`パラメータを追加
- ✅ 期間変更時に自動的にヒートマップデータを再取得
- ✅ `dateRange` stateを追加して期間選択を管理

**技術的な変更**:
- `app/heatmap/page.tsx`:
  - `dateRange` stateを追加
  - `useEffect`フック内で期間に基づいて`startDate`と`endDate`を計算
  - `/api/heatmap`エンドポイントに期間パラメータを追加
  - `useEffect`の依存配列に`dateRange`を追加

**期間計算ロジック**:
```typescript
if (dateRange !== 'all') {
  const end = new Date()
  const start = new Date()
  
  switch (dateRange) {
    case '7days':
      start.setDate(start.getDate() - 7)
      break
    case '30days':
      start.setDate(start.getDate() - 30)
      break
    case '90days':
      start.setDate(start.getDate() - 90)
      break
  }
  
  startDate = start.toISOString().split('T')[0]
  endDate = end.toISOString().split('T')[0]
}
```

---

## 📊 修正前後の比較

### 修正前

- サイト選択とページ選択が別々のカード
- 期間選択機能なし
- フィルターが分散していて使いにくい

### 修正後

- ✅ サイト選択、期間選択、ページ選択が1つのカードに統合
- ✅ 期間選択機能を追加
- ✅ 3列のグリッドレイアウトで見やすく整理
- ✅ 期間に基づいてヒートマップデータをフィルタリング

---

## 🔧 UI/UXの改善

### フィルターカードのレイアウト

```
┌─────────────────────────────────────────┐
│ フィルター                                │
│ サイト、期間、ページを選択してヒートマップを表示 │
├─────────────────────────────────────────┤
│ [サイト選択]  [期間選択]  [ページ選択]    │
│  ┌──────┐    ┌──────┐    ┌──────┐     │
│  │  ▼   │    │  ▼   │    │  ▼   │     │
│  └──────┘    └──────┘    └──────┘     │
└─────────────────────────────────────────┘
```

### 期間選択オプション

- 過去7日間
- 過去30日間
- 過去90日間
- 全期間

---

## ✅ 修正後の動作確認項目

1. **フィルターカードの表示**: サイト選択、期間選択、ページ選択が1つのカードに表示される
2. **期間選択の動作**: 期間を変更すると、ヒートマップデータが再取得される
3. **レスポンシブ対応**: モバイル表示でも3列が適切に1列に折り返される
4. **データフィルタリング**: 選択した期間のデータのみが表示される

---

## 📝 関連ファイル

- `app/heatmap/page.tsx`: ヒートマップページのメインコンポーネント

---

**最終更新**: 2025年1月26日

